{{template "base" .}}

{{ define "title" }}
    Delta-V Daten Hochladen
{{ end }}

{{ define "content" }} 
    <form action="" mehode="POST">
        <div class="form-group">
            <label for="fhxFile">FHX-Datei</label>
            <input type="file" class="w3-input" id="fhxFile" name="fhxFile" onchange="upload(event)" accept=".fhx">
        </div>
        <div class="form-group">
            <label for="fhxPlant">Betrieb</label>
            <select id="plantSelectItem"></select>>
        </div>
        <a href="javascript:void(0)" class="button" onClick="load(event)">Laden</a>
    </form>
{{ end }}

{{ define "js" }}
<script>
const plantItems = document.getElementById('plantSelectItem');
// const fhxFile = document.getElementById('fhxFile');
// let storePlant;
// let hasStorePlant = loadStorage()
//   function loadStorage() {
//     storePlant = localStorage.getItem('plant')        
//         if (storePlant) {
//             storePlant = JSON.parse(storePlant)   
//         }else {
//             let idPlant = plantItems.options[plantItems.selectedIndex].value;
//             let valuePlant = plantItems.options[plantItems.selectedIndex].textContent;
//             console.log(valuePlant);
//             if (valuePlant === "leer") {                
//                 return false;
//             }
//             saveSelectItem(
//                 idPlant,
//                 valuePlant,                        
//             );
//             storePlant = localStorage.getItem('plant');
//             storePlant = JSON.parse(storePlant);
//             return true;
//         } 
//   }
  
//   fhxFile.style.backgroundColor = hasStorePlant ? "red" : "blue";
   
    // function upload(e) {
    //         const files = e.target.files || e.dataTransfer.files;
    //         if (!files.length) return;
    //         const file = files[0].name;
    //         let text = ""
    //         const fr = new FileReader();
    //         fr.onload = async () => {
    //             text = fr.result;      
    //            if (!loadStorage()) return;
    //             const requestOptions = {
    //                 method: "POST",
    //                 headers: { "Content-Type": "application/json" },
    //                 body: JSON.stringify({ text: text, name: file, plant_id: storePlant.plant_id }),
    //             };
    //             await fetch("/fhx/readFhx", requestOptions);
    //         }
    //         fr.readAsText(files[0]);
    // }
    document.addEventListener('DOMContentLoaded', () => {
       
        // const plant = document.getElementById('plant')
        
        const plants = async () => {
            try {
                const res = await fetch('/plants/allPlants')
                const data = await res.json()
                for (let plant of data) {           
                    // console.log(plant.plant_id);    
                    plantItems.innerHTML += `<option value="${plant.plant_id}">${plant.plant}</option>`;
                }
            } catch (error) {
                console.error("Plant load in main.js", error)
            }
        }  
        plants()       
    });
    
</script>
{{end}}